<!DOCTYPE html>
<html lang="en">
    <head>
        <link rel='stylesheet' href='/play.css' type='text/css' />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Play ClueCard | E-ScoreCard for game clues</title>
        <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
        <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
        <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
        <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
        <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
        <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
        <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
        <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
        <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
        <link rel="icon" type="image/png" sizes="310x310" href="/ms-icon-310x310.png">
        <link rel="icon" type="image/png" sizes="512x512" href="/favicon-512x512.png">
        <link rel="icon" type="image/png" sizes="1000x1000" href="/favicon-1000x1000.png">
        <link rel="icon" type="image/png" sizes="192x192" href="/android-icon-192x192.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
        <meta name="msapplication-TileColor" content="#7000FF">
        <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
        <meta name="theme-color" content="#7000FF">
        <link rel="manifest" href="/manifest.json">
    </head>
    <body>
        <script>
            console.log("Running... (install.js)");
            window.addEventListener("load", function() {
                if ("serviceWorker" in navigator) {
                    console.log("Trying to install service worker... (install.js)");
                    navigator.serviceWorker
                        .register("/sw.js")
                        .then(function(reg) {
                            console.log("Service worker: installed! (install.js)", reg);
                        }).catch (err => console.log("Service worker: not registered (install.js)", err));
                }
                let deferredPrompt;
                const addBtn = document.getElementById("add2hs");
                window.addEventListener('beforeinstallprompt', (e) => {
                    // Prevent Chrome 67 and earlier from automatically showing the prompt
                    e.preventDefault();
                    // Stash the event so it can be triggered later.
                    deferredPrompt = e;
                    // Update UI to notify the user they can add to home screen
                    addBtn.style.setProperty("opacity", "1", "important");
                    addBtn.style.setProperty("visibility", "visible", "important");
                    addBtn.addEventListener('click', (e) => {
                        // hide our user interface that shows our A2HS button
                        addBtn.style.setProperty("opacity", "0", "important");
                        addBtn.style.setProperty("visibility", "hidden", "important");
                        // Show the prompt
                        deferredPrompt.prompt();
                        // Wait for the user to respond to the prompt
                        deferredPrompt.userChoice.then((choiceResult) => {
                            if (choiceResult.outcome === 'accepted') {
                                console.log('User accepted the A2HS prompt (install.js)');
                            } else {
                                console.log('User dismissed the A2HS prompt (install.js)');
                            }
                            deferredPrompt = null;
                        });
                    });
                });
            });
            function registerGroup() {
                var xmlhttp = new XMLHttpRequest();
                var url = "/addid/" + {{uid}} + "/" + document.getElementById("username").value;

                xmlhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        window.location.href = this.responseText;
                    }
                };
                xmlhttp.open("GET", url, true);
                xmlhttp.send();
            }
            function goHome() {
                window.location.href = "/";
            }
        </script>
        <noscript>Hey, this site won't make any sense if you turn JavaScript off. Can you turn it on again or use a different browser with JavaScript on? Thanks.</noscript>
        <button onClick="goHome();" class="homebutton">Home</button>
        <h1>Play...</h1>
        <h3>You're in the game. Let's make this happen.</h3>
        <h4>(Your ID is {{uid}} and your PIN is {{upin}}.)</h4>
        <input id="cardname" type="text" placeholder="Card name"><br/>
        <button onClick="registerUser()">Add card</button><br/>
        <input id="username" type="text" placeholder="User ID"><br/>
        <button onClick="registerGroup()">Add to group</button><br/>
        <button id="add2hs" style="opacity: 0; visibility: hidden;">Add E-Scorecard to Home Screen</button>
    </body>
</html>
